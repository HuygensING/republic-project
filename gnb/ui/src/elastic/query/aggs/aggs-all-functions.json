{
  "nested_functions": {
    "nested": {
      "path": "functions"
    },
    "aggs": {
      "filter_functions": {
        "filter": {
          "bool": {
            "must": []
          }
        },
        "aggs": {
          "function_id": {
            "terms": {
              "field": "functions.id"
            },
            "aggs": {
              "function_name": {
                "terms": {
                  "field": "functions.name.keyword"
                },
                "aggs": {
                  "unnest_functions": {
                    "reverse_nested": {},
                    "aggs": {
                      "people": {
                        "terms": {
                          "field": "id",
                          "size": 10000
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
